<script src="../../node_modules/redux-saga/dist/redux-saga.js"></script>

<script>

    (function() {
        const effects = ReduxSaga.effects;

        // worker Saga: will be fired on USER_FETCH_REQUESTED actions
        function* loadList(action) {
            try {
                yield effects.put(MyApp.actions.showSpinner(true));
                let result = [1, 2, 3, 4, 5];
                yield ReduxSaga.delay(1000);
                yield effects.put(MyApp.actions.setLoadedList(result));
                yield effects.put(MyApp.actions.showSpinner(false));
            } catch (e) {
                console.log(e);
                yield effects.put(MyApp.actions.clearLoadedList());
                yield effects.put(MyApp.actions.showSpinner(false));
            }
        }

        function* clearList(action) {
            yield effects.put(MyApp.actions.showSpinner(true));
            yield ReduxSaga.delay(1000);
            yield effects.put(MyApp.actions.clearLoadedList());
            yield effects.put(MyApp.actions.showSpinner(false));
        }

        function* loadClubs(action) {
            try {
                yield effects.put(MyApp.actions.showSpinner(true));
                yield effects.put(MyApp.actions.setQueryUrl(''));
                yield effects.put(MyApp.actions.setQueryUrl('/clubs'));
            } catch (e) {
                console.log(e);
                yield effects.put(MyApp.actions.setQueryUrl(null));
                yield effects.put(MyApp.actions.showSpinner(false));
            }
        }

        function* finalizeLoadClubs(action) {
            try {
                yield effects.put(MyApp.actions.setClubList(action.clubs));
                yield effects.put(MyApp.actions.showSpinner(false));
            } catch (e) {
                console.log(e);
                yield effects.put(MyApp.actions.setClubList(null));
                yield effects.put(MyApp.actions.showSpinner(false));
            }
        }

        /*
          Starts fetchUser on each dispatched `USER_FETCH_REQUESTED` action.
          Allows concurrent fetches of user.
        */
        function* rootSaga() {
            yield effects.takeEvery('LOAD_LIST', loadList);
            yield effects.takeEvery('CLEAR_LIST', clearList);
            yield effects.takeEvery('LOAD_CLUBS', loadClubs);
            yield effects.takeEvery('FINALIZE_LOAD_CLUBS', finalizeLoadClubs);
        }


        AppStore.rootSaga = rootSaga;

    }());
</script>